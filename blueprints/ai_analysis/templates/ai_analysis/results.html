{% extends "base.html" %}

{% block title %}OSINT Tracker - AI Analysis Results{% endblock %}

{% block content %}
<div class="animate__animated animate__fadeIn">
    <!-- Header Section -->
    <div class="bg-gray-800 rounded-lg shadow-lg overflow-hidden mb-8 border border-gray-700">
        <div class="px-6 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-white">AI Analysis Results</h1>
                    <p class="text-gray-300 mt-1">
                        Analysis for 
                        <span class="text-green-400 font-semibold">{{ results.target }}</span>
                        <span class="text-gray-400">({{ results.analysis_type|capitalize }} Analysis)</span>
                    </p>
                </div>
                <div>
                    <span class="text-sm text-gray-400">Analysis Date: {{ results.scan_date.strftime('%b %d, %Y %H:%M') }}</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Risk Score Card -->
    <div class="bg-gray-800 rounded-lg shadow-lg overflow-hidden mb-8 border border-gray-700">
        <div class="px-6 py-6">
            <div class="flex flex-col md:flex-row items-center">
                <div class="w-full md:w-1/4 flex justify-center mb-6 md:mb-0">
                    <div class="relative inline-block w-36 h-36">
                        <svg class="w-full h-full" viewBox="0 0 36 36">
                            <path class="stroke-current text-gray-600" stroke-width="2" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                            <path class="stroke-current {% if results.risk_score < 25 %}text-green-500
                                       {% elif results.risk_score < 50 %}text-yellow-500
                                       {% elif results.risk_score < 75 %}text-orange-500
                                       {% else %}text-red-500{% endif %}"
                                  stroke-width="2" fill="none" stroke-linecap="round"
                                  stroke-dasharray="{{ results.risk_score }}, 100"
                                  d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                            <text x="18" y="18.5" class="fill-current text-white text-3xl font-bold" text-anchor="middle">{{ results.risk_score }}</text>
                            <text x="18" y="24" class="fill-current text-gray-400 text-xs" text-anchor="middle">/100</text>
                        </svg>
                    </div>
                </div>
                
                <div class="w-full md:w-3/4 md:pl-6">
                    <h2 class="text-xl font-semibold text-white mb-3">Risk Assessment</h2>
                    
                    <div class="mb-4">
                        <div class="flex items-center mb-2">
                            <div class="w-full bg-gray-700 rounded-full h-4">
                                <div class="h-4 rounded-full {% if results.risk_score < 25 %}bg-green-500
                                            {% elif results.risk_score < 50 %}bg-yellow-500
                                            {% elif results.risk_score < 75 %}bg-orange-500
                                            {% else %}bg-red-500{% endif %}" 
                                     style="width: {{ results.risk_score }}%"></div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between text-sm text-gray-400">
                            <span>Low Risk</span>
                            <span>Medium Risk</span>
                            <span>High Risk</span>
                        </div>
                    </div>
                    
                    <p class="text-gray-300">
                        {% if results.risk_score < 25 %}
                            The analysis indicates a <span class="text-green-400 font-medium">low risk profile</span> with minimal digital exposure.
                            Limited information is available that could be leveraged for potential targeting.
                        {% elif results.risk_score < 50 %}
                            The analysis indicates a <span class="text-yellow-400 font-medium">moderate risk profile</span> with some digital exposure.
                            Several data points could potentially be used for social engineering or targeted attacks.
                        {% elif results.risk_score < 75 %}
                            The analysis indicates a <span class="text-orange-400 font-medium">significant risk profile</span> with substantial digital exposure.
                            Multiple avenues for potential targeting or information gathering have been identified.
                        {% else %}
                            The analysis indicates a <span class="text-red-400 font-medium">critical risk profile</span> with extensive digital exposure.
                            Comprehensive personal information is available that presents a serious security concern.
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI Insights -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="md:col-span-2 bg-gray-800 rounded-lg shadow-lg overflow-hidden border border-gray-700">
            <div class="px-6 py-5 border-b border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-medium text-white">AI-Generated Insights</h3>
                
                <div>
                    <span class="px-3 py-1 text-xs rounded-full bg-green-900 text-green-300">
                        <i class="fas fa-brain mr-1"></i> AI Analysis
                    </span>
                </div>
            </div>
            
            <div class="px-6 py-6">
                <div class="space-y-6">
                    {% for insight in results.insights %}
                    <div class="bg-gray-750 rounded-lg p-4 border border-gray-700">
                        <div class="flex justify-between items-start mb-3">
                            <h4 class="text-white font-medium">{{ insight.title }}</h4>
                            <span class="px-2 py-1 text-xs rounded-full 
                                       {% if insight.confidence == 'High' %}bg-green-900 text-green-300
                                       {% elif insight.confidence == 'Medium' %}bg-yellow-900 text-yellow-300
                                       {% else %}bg-red-900 text-red-300{% endif %}">
                                {{ insight.confidence }} Confidence
                            </span>
                        </div>
                        <p class="text-gray-300">{{ insight.description }}</p>
                        <div class="mt-3">
                            <span class="px-2 py-1 text-xs rounded-full bg-gray-700 text-gray-300">
                                {{ insight.category }}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <div class="bg-gray-800 rounded-lg shadow-lg overflow-hidden border border-gray-700">
            <div class="px-6 py-5 border-b border-gray-700">
                <h3 class="text-lg font-medium text-white">Analysis Summary</h3>
            </div>
            
            <div class="px-6 py-6">
                <!-- Categories breakdown -->
                <h4 class="text-white font-medium mb-3">Insight Categories</h4>
                
                {% set categories = {} %}
                {% for insight in results.insights %}
                    {% if insight.category not in categories %}
                        {% do categories.update({insight.category: 1}) %}
                    {% else %}
                        {% do categories.update({insight.category: categories[insight.category] + 1}) %}
                    {% endif %}
                {% endfor %}
                
                <div class="space-y-3 mb-6">
                    {% for category, count in categories.items() %}
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="text-sm text-gray-300">{{ category }}</span>
                            <span class="text-sm text-gray-400">{{ count }} insights</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="h-2 rounded-full 
                                       {% if category == 'Security' %}bg-red-500
                                       {% elif category == 'Privacy' %}bg-blue-500
                                       {% elif category == 'Identity' %}bg-purple-500
                                       {% elif category == 'Professional' %}bg-green-500
                                       {% elif category == 'Exposure' %}bg-orange-500
                                       {% elif category == 'Interests' %}bg-yellow-500
                                       {% elif category == 'History' %}bg-teal-500
                                       {% elif category == 'Account History' %}bg-indigo-500
                                       {% elif category == 'Legitimacy' %}bg-green-500
                                       {% elif category == 'Infrastructure' %}bg-blue-500
                                       {% elif category == 'Intent' %}bg-purple-500
                                       {% else %}bg-gray-500{% endif %}" 
                                 style="width: {{ (count / results.insights|length * 100) }}%"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Confidence breakdown -->
                <h4 class="text-white font-medium mb-3">Confidence Levels</h4>
                
                {% set confidence_levels = {'High': 0, 'Medium': 0, 'Low': 0} %}
                {% for insight in results.insights %}
                    {% do confidence_levels.update({insight.confidence: confidence_levels[insight.confidence] + 1}) %}
                {% endfor %}
                
                <div class="space-y-3">
                    {% for level, count in confidence_levels.items() %}
                    {% if count > 0 %}
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="text-sm text-gray-300">{{ level }} Confidence</span>
                            <span class="text-sm text-gray-400">{{ count }} insights</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="h-2 rounded-full 
                                       {% if level == 'High' %}bg-green-500
                                       {% elif level == 'Medium' %}bg-yellow-500
                                       {% else %}bg-red-500{% endif %}" 
                                 style="width: {{ (count / results.insights|length * 100) }}%"></div>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Security Recommendations -->
    <div class="bg-gray-800 rounded-lg shadow-lg overflow-hidden mb-8 border border-gray-700">
        <div class="px-6 py-5 border-b border-gray-700">
            <h3 class="text-lg font-medium text-white">Security Recommendations</h3>
        </div>
        
        <div class="overflow-hidden">
            {% for recommendation in results.recommendations %}
            <div class="px-6 py-5 {% if not loop.last %}border-b border-gray-700{% endif %} hover:bg-gray-750">
                <div class="flex items-start">
                    <div class="flex-shrink-0 mt-1">
                        <div class="w-10 h-10 {% if recommendation.priority == 'Critical' %}bg-red-900 text-red-300
                                   {% elif recommendation.priority == 'High' %}bg-orange-900 text-orange-300
                                   {% elif recommendation.priority == 'Medium' %}bg-yellow-900 text-yellow-300
                                   {% else %}bg-blue-900 text-blue-300{% endif %} 
                             rounded-full flex items-center justify-center">
                            <i class="fas {% if recommendation.priority == 'Critical' %}fa-exclamation-triangle
                                      {% elif recommendation.priority == 'High' %}fa-exclamation-circle
                                      {% elif recommendation.priority == 'Medium' %}fa-bell
                                      {% else %}fa-info-circle{% endif %}"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <div class="flex items-center mb-2">
                            <h4 class="text-white font-medium">{{ recommendation.title }}</h4>
                            <span class="ml-3 px-2 py-1 text-xs rounded-full 
                                       {% if recommendation.priority == 'Critical' %}bg-red-900 text-red-300
                                       {% elif recommendation.priority == 'High' %}bg-orange-900 text-orange-300
                                       {% elif recommendation.priority == 'Medium' %}bg-yellow-900 text-yellow-300
                                       {% else %}bg-blue-900 text-blue-300{% endif %}">
                                {{ recommendation.priority }} Priority
                            </span>
                        </div>
                        <p class="text-gray-300">{{ recommendation.description }}</p>
                        <div class="mt-2">
                            <span class="px-2 py-1 text-xs rounded-full bg-gray-700 text-gray-300">
                                {{ recommendation.category }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mb-8">
        <a href="{{ url_for('ai_analysis.index') }}" class="flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 md:text-lg transition duration-300 ease-in-out">
            <i class="fas fa-brain mr-2"></i> New Analysis
        </a>
        <button class="flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 md:text-lg transition duration-300 ease-in-out">
            <i class="fas fa-file-export mr-2"></i> Export Report
        </button>
    </div>
</div>
{% endblock %}